import{_ as o,c as a,a4 as n,o as e}from"./chunks/framework.qvkBPMhT.js";const D=JSON.parse('{"title":"WebHook","description":"","frontmatter":{"outline":"deep","title":"WebHook"},"headers":[],"relativePath":"broker/webhook.md","filePath":"broker/webhook.md","lastUpdated":1691570666000}'),p={name:"broker/webhook.md"};function l(t,s,c,r,y,i){return e(),a("div",null,s[0]||(s[0]=[n(`<h2 id="webhook" tabindex="-1">WebHook <a class="header-anchor" href="#webhook" aria-label="Permalink to &quot;WebHook&quot;">​</a></h2><p><code>WebHook</code>是一个基于<code>HTTP</code>的Broker，它可以将任务对外暴露一个HTTP接口，用于接收来自<code>HTTP</code>请求的消息。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> onestep </span><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> step</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> WebHookBroker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;"># 对外提供一个webhook接口，接收外部的消息</span></span>
<span class="line"><span style="color:#DBD7CAEE;">webhook_broker </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> WebHookBroker</span><span style="color:#666666;">(</span><span style="color:#BD976A;">path</span><span style="color:#666666;">=</span><span style="color:#C98A7D77;">&quot;</span><span style="color:#C98A7D;">/push</span><span style="color:#C98A7D77;">&quot;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#666666;">@</span><span style="color:#80A665;">step</span><span style="color:#666666;">(</span><span style="color:#BD976A;">from_broker</span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;">webhook_broker</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#CB7676;">def</span><span style="color:#80A665;"> waiting_messages</span><span style="color:#666666;">(</span><span style="color:#DBD7CAEE;">message</span><span style="color:#666666;">):</span></span>
<span class="line"><span style="color:#B8A965;">    print</span><span style="color:#666666;">(</span><span style="color:#C98A7D77;">&quot;</span><span style="color:#C98A7D;">收到消息：</span><span style="color:#C98A7D77;">&quot;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> message</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">step</span><span style="color:#666666;">.</span><span style="color:#DBD7CAEE;">start</span><span style="color:#666666;">(</span><span style="color:#BD976A;">block</span><span style="color:#666666;">=</span><span style="color:#4D9375;">True</span><span style="color:#666666;">)</span></span></code></pre></div><p>上述代码会在<code>http://127.0.0.1:8090/push</code> 提供一个<code>POST</code>接口，用于接收消息。</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>默认端口为<code>8090</code> ，可以通过<code>port</code>参数来修改。</p></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#80A665;">curl</span><span style="color:#C99076;"> -H</span><span style="color:#C98A7D77;"> &quot;</span><span style="color:#C98A7D;">Content-Type: application/json</span><span style="color:#C98A7D77;">&quot;</span><span style="color:#C99076;"> -X</span><span style="color:#C98A7D;"> POST</span><span style="color:#C99076;"> -d</span><span style="color:#C98A7D77;"> &#39;</span><span style="color:#C98A7D;">{&quot;body&quot;: &quot;Hello OneStep&quot;}</span><span style="color:#C98A7D77;">&#39;</span><span style="color:#C98A7D77;"> &quot;</span><span style="color:#C98A7D;">http://127.0.0.1:8090/push</span><span style="color:#C98A7D77;">&quot;</span></span></code></pre></div><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki vitesse-dark vp-code" tabindex="0"><code><span class="line"><span>收到消息： {&#39;body&#39;: &#39;Hello OneStep&#39;, &#39;extra&#39;: {&#39;task_id&#39;: &#39;2a922df2-2419-4978-9184-4227558d641b&#39;, &#39;publish_time&#39;: 1691568238.781, &#39;failure_count&#39;: 0}}</span></span></code></pre></div>`,7)]))}const b=o(p,[["render",l]]);export{D as __pageData,b as default};
